步骤 1（权威入口落地）：建立并启用“NY 交易日权威模块”
目标：把“具体时刻→纽约交易日 YYYY-MM-DD”的决策，收拢到唯一 API，所有层只认它。
动作：新增 apps/web/app/lib/nyDay.ts（名称你可改，但必须唯一），提供并仅保留这些入口：
resolveTradingDayStr(now?: number|Date, opts?: { freeze?: string })
previousTradingDay(ymd: string): string、isTradingDay(ymd: string): boolean（内置 NYSE 节假日表）
parseNyDate(ymd: string): Date（纽约正午锚点防 UTC 偏日）
marketBoundaries(ymd: string)（09:30/16:00 边界）
并强制改造调用方的依赖关系：
UI（DashboardMetrics/PositionsTable）、价格管线（priceService 的实时/收盘归属）、回放与聚合（runAll*、calcMetrics*）、诊断（evaluateCloseRequirement、generateDailyResults）全部只调用 nyDay.resolveTradingDayStr 获取“今天/评估日”。
在构建期注入守卫（eslint rule 或小脚本）：凡匹配 toISOString().slice(0,10)、new Date('YYYY-MM-DD')、手写毫秒偏移，一律报错。

验收（对应《规则本文》验收口径）：
四环境一致：以“纽约 2025-10-06 22:30”为样例，NY/London/Beijing/Node 结果都返 2025-10-06。
边界正确：09:29:59 仍是前一交易日，09:30:00 起算当日；16:00:00 后仍归当日。
DST 周无偏移；节假日按表返回非交易日。
统一表示：全仓不再以 Date/ISO 代表“日”，只传 YYYY-MM-DD。

步骤 2（高危替换与硬闸口）：集中清理 + 一次性对齐
目标：把自检报告里的高风险命中点一次性替换到权威入口，切断回归源头。
动作：
统一日归属：getTradingDateStr、任何手写“今天/昨天/冻结日”逻辑，全部改为调用 resolveTradingDayStr；盘前/冻结场景与 UI 同步。
移除手写偏移：DAY_MS、12*60*60*1000 全面下线，改用 parseNyDate + 交易日函数推进/回退。
旧脚本处理（public/js）：若线上仍被引用，改造为调用 window.nyDay.*；否则从构建中剔除。
硬闸口：在运行期加断言（仅开发/测试环境）——一旦检测到 Date→日的本地/UTC直切，直接抛错并标注文件行号。

验收：
盘前误报消失：09:30 前不再出现“缺官方收盘价”的假警报（价格与 UI 同一交易日键）。
SSR/CSR 一致：同一数据在不同时区浏览器渲染与 Node 侧一致。
扫描为零：仓库内禁止项匹配结果为 0；违规即 CI 失败。
节假日当天 evaluateCloseRequirement 不再要求官方收盘价。
